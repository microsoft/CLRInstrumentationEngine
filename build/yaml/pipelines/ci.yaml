# Copyright (c) Microsoft Corporation. All rights reserved.
# Licensed under the MIT License.

# Build Pipeline: Continuous Integration
# Validates:
# - binaries can be built for all platforms and configurations
# - packages can be built for all platforms and configurations

name: $(date:yyyyMMdd)$(rev:rr)

parameters:
  OneESPT: false
  IsMicroBuildInternal: false

variables:
  TeamName: ClrInstrumentationEngine

stages:
- stage: Build
  jobs:
  # Binaries (Windows & Linux)
  - template: ../jobs/binaries.yaml@self
    parameters:
      IndexSources: true
      Configuration: Both
      OneESPT: ${{ parameters.OneESPT }}
      IsMicroBuildInternal: ${{ parameters.IsMicroBuildInternal }}

- stage: Test
  dependsOn: Build
  jobs:
  # Tests (Windows)
  - template: ../jobs/tests.yaml@self
    parameters:
      Configuration: Both
      IsMicroBuildInternal: ${{ parameters.IsMicroBuildInternal }}

- stage: Package
  dependsOn: Build
  jobs:
  # Packages (Windows & Linux)
  - template: ../jobs/packages.yaml@self
    parameters:
      Configuration: Both
      OneESPT: ${{ parameters.OneESPT }}
      IsMicroBuildInternal: ${{ parameters.IsMicroBuildInternal }}