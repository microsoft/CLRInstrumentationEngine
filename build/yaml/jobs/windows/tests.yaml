# Job Template: Test Windows Binaries

jobs:
- job: Test_Windows_Binaries
  displayName: Windows Tests

  strategy:
    matrix:
      Debug_x86:
        Configuration: 'Debug'
        Platform: 'x86'
        RunSettingsFile: 'x86.runsettings'
      Debug_x64:
        Configuration: 'Debug'
        Platform: 'x64'
        RunSettingsFile: 'x64.runsettings'
      Debug_AnyCPU:
        Configuration: 'Debug'
        Platform: 'AnyCPU' # no-space; used in the context of files, not task parameters.
        RunSettingsFile: 'x86.runsettings'

  pool:
    name: VSEng-MicroBuildVS2017
    demands:
    - msbuild
    - vstest

  workspace:
    clean: outputs

  steps:
  - checkout: self
    clean: true

  - template: ../../steps/windows/tests.yaml
    parameters:
      WindowsBinRoot: $(Build.ArtifactStagingDirectory)\binaries-windows-$(Configuration)
      Platform: $(Platform)

  - template: ../../steps/microbuild/cleanup.yaml

  - template: ../../steps/microbuild/componentgovernance.yaml