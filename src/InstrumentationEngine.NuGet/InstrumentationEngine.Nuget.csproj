<?xml version="1.0" encoding="utf-8"?>
<!-- Copyright (c) Microsoft Corporation. All rights reserved.
      -->
<Project>
  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildProjectDirectory), 'EnlistmentRoot.marker'))\build\Common.props" />
  <Import Project="Sdk.props" Sdk="Microsoft.NET.Sdk" />
  <PropertyGroup>
    <GenerateAssemblyFileVersionAttribute>false</GenerateAssemblyFileVersionAttribute>
    <GenerateAssemblyInfo>false</GenerateAssemblyInfo>
    <GeneratePackageOnBuild>true</GeneratePackageOnBuild>
    <ResolveNuGetPackages>true</ResolveNuGetPackages>
    <TargetFramework>netstandard2.0</TargetFramework>
    <NoBuild>true</NoBuild>
    <IncludeBuildOutput>false</IncludeBuildOutput>
    <NuspecFile>InstrumentationEngine.nuspec</NuspecFile>
    <NuspecProperties>version=$(PackageVersion)</NuspecProperties>
    <NuspecProperties>$(NuspecProperties);authors=$(PackageAuthors)</NuspecProperties>
    <NuspecProperties>$(NuspecProperties);configuration=$(Configuration)</NuspecProperties>
    <NuspecProperties>$(NuspecProperties);platform=$(Platform)</NuspecProperties>
    <NuspecProperties>$(NuspecProperties);scriptdir=$(MSBuildProjectDirectory)</NuspecProperties>
    <NuspecBasePath>$(BinRoot)</NuspecBasePath>
    <NuspecOutputDirectory>$(OutDir)\$(Platform)</NuspecOutputDirectory>
    <PreserveCompilationContext>false</PreserveCompilationContext>
    <ProjectGuid>{0B12FD8F-83DE-4A80-9BC1-ABE67E0E808A}</ProjectGuid>
    <OutputType>Library</OutputType>
    <RootNamespace>Microsoft.Diagnostics.InstrumentationEngine.NuGet</RootNamespace>
    <AssemblyName>Microsoft.Diagnostics.InstrumentationEngine.NuGet</AssemblyName>
    <CopyBuildOutputToOutputDirectory>false</CopyBuildOutputToOutputDirectory>
    <CopyOutputSymbolsToOutputDirectory>false</CopyOutputSymbolsToOutputDirectory>
    <NoWarn>2008</NoWarn>
  </PropertyGroup>
  <PropertyGroup>
    <DefaultItemExcludes>$(DefaultItemExcludes);obj\**</DefaultItemExcludes>
  </PropertyGroup>
  <ItemGroup>
    <None Include="install.ps1">
      <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
    </None>
  </ItemGroup>
  <!-- Extensions host -->
  <Choose>
    <When Condition="'$(PlatformOS)'=='Linux'">
      <!-- Building Nuget for Linux is only supported on VSTS The following properties must be set by the build -->
      <!--NuGetBinInput-->
      <PropertyGroup>
        <NugetSuffix>$(Platform)_$(LinuxDistro)</NugetSuffix>
        <NuspecProperties>$(NuspecProperties);bindir=$(NugetBinInput)</NuspecProperties>
        <NuspecProperties>$(NuspecProperties);suffix=$(NugetSuffix)</NuspecProperties>
      </PropertyGroup>
    </When>
    <Otherwise>
      <ItemGroup>
        <Content Include="$(BinRoot)\$(Configuration)\$(Platform)\Microsoft.InstrumentationEngine.ExtensionsHost_$(Platform).dll">
          <Link>InstrumentationEngine\$(Platform)\Microsoft.InstrumentationEngine.ExtensionsHost_$(Platform).dll</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\$(Platform)\Microsoft.InstrumentationEngine.ExtensionsHost_$(Platform).pdb">
          <Link>InstrumentationEngine\$(Platform)\Microsoft.InstrumentationEngine.ExtensionsHost_$(Platform).pdb</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\$(Platform)\Microsoft.InstrumentationEngine.Extensions.config">
          <Link>InstrumentationEngine\$(Platform)\Microsoft.InstrumentationEngine.Extensions.config</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\$(Platform)\Microsoft.InstrumentationEngine.Extensions.Base_$(Platform).dll">
          <Link>InstrumentationEngine\$(Platform)\Microsoft.InstrumentationEngine.Extensions.Base_$(Platform).dll</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\$(Platform)\Microsoft.InstrumentationEngine.Extensions.Base_$(Platform).pdb">
          <Link>InstrumentationEngine\$(Platform)\Microsoft.InstrumentationEngine.Extensions.Base_$(Platform).pdb</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\AnyCPU\Microsoft.Diagnostics.Instrumentation.Extensions.Base.dll">
          <Link>InstrumentationEngine\$(Platform)\Microsoft.Diagnostics.Instrumentation.Extensions.Base.dll</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\AnyCPU\Microsoft.Diagnostics.Instrumentation.Extensions.Base.pdb">
          <Link>InstrumentationEngine\$(Platform)\Microsoft.Diagnostics.Instrumentation.Extensions.Base.pdb</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\$(Platform)\MicrosoftInstrumentationEngine_$(Platform).dll">
          <Link>InstrumentationEngine\$(Platform)\MicrosoftInstrumentationEngine_$(Platform).dll</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
        <Content Include="$(BinRoot)\$(Configuration)\$(Platform)\MicrosoftInstrumentationEngine_$(Platform).pdb">
          <Link>InstrumentationEngine\$(Platform)\MicrosoftInstrumentationEngine_$(Platform).pdb</Link>
          <CopyToOutputDirectory>PreserveNewest</CopyToOutputDirectory>
        </Content>
      </ItemGroup>
      <PropertyGroup>
        <NugetBinInput>$(BinRoot)\$(Configuration)\$(Platform)\InstrumentationEngine</NugetBinInput>
        <NugetSuffix>$(Platform)</NugetSuffix>
        <NuspecProperties>$(NuspecProperties);bindir=$(NugetBinInput)</NuspecProperties>
        <NuspecProperties>$(NuspecProperties);suffix=$(NugetSuffix)</NuspecProperties>
      </PropertyGroup>
    </Otherwise>
  </Choose>
  <Import Project="Sdk.targets" Sdk="Microsoft.NET.Sdk" />
  <Import Project="$([MSBuild]::GetDirectoryNameOfFileAbove($(MSBuildThisFileDirectory), EnlistmentRoot.marker))\build\Common.targets" />
</Project>